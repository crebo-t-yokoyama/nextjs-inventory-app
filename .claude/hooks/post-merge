#!/bin/bash

# Post-merge hook for Next.js Application Template
# „Åì„ÅÆ„Éï„ÉÉ„ÇØ„ÅØ Claude Code „Å´„Çà„Çã„Éû„Éº„Ç∏Âæå„Å´Ëá™ÂãïÂÆüË°å„Åï„Çå„Åæ„Åô

set -e

echo "üîÑ Post-merge operations..."

# 1. ‰æùÂ≠òÈñ¢‰øÇ„ÅÆÊõ¥Êñ∞„ÉÅ„Çß„ÉÉ„ÇØ
echo "üì¶ Checking for dependency updates..."
if command -v pnpm &> /dev/null; then
    if [ -f "package.json" ]; then
        pnpm install || {
            echo "‚ö†Ô∏è  Failed to install dependencies"
        }
    fi
else
    echo "‚ö†Ô∏è  pnpm not found, skipping dependency installation"
fi

# 2. „Éá„Éº„Çø„Éô„Éº„Çπ„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÔºàSupabaseÔºâ
echo "üóÑÔ∏è  Checking for database migrations..."
if [ -d "supabase/migrations" ]; then
    echo "üìã Database migrations found - please check if they need to be applied"
fi

# 3. „Éì„É´„Éâ„ÉÜ„Çπ„Éà
echo "üèóÔ∏è  Testing build after merge..."
if command -v pnpm &> /dev/null; then
    pnpm build || {
        echo "‚ö†Ô∏è  Build failed after merge - please check for conflicts"
        exit 1
    }
else
    echo "‚ö†Ô∏è  pnpm not found, skipping build test"
fi

# 4. „ÉÜ„Çπ„ÉàÂÆüË°å
echo "üß™ Running tests after merge..."
if command -v pnpm &> /dev/null; then
    pnpm test --run || {
        echo "‚ö†Ô∏è  Tests failed after merge - please review changes"
    }
else
    echo "‚ö†Ô∏è  pnpm not found, skipping tests"
fi

echo "‚úÖ Post-merge operations completed!"