#!/bin/bash

# Pre-commit hook for Next.js Application Template
# ã“ã®ãƒ•ãƒƒã‚¯ã¯ Claude Code ã«ã‚ˆã‚‹ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™

set -e

# éŸ³å£°é€šçŸ¥ã®èª­ã¿è¾¼ã¿
if [ -f ".claude/hooks/task-narrator" ]; then
    source .claude/hooks/task-narrator
    task_start "ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯" "commit"
fi

echo "ğŸ” Pre-commit checks..."

# 1. TypeScriptå‹ãƒã‚§ãƒƒã‚¯
echo "ğŸ“ Running TypeScript checks..."
if command -v pnpm &> /dev/null; then
    pnpm type-check || {
        echo "âŒ TypeScript type check failed"
        exit 1
    }
else
    echo "âš ï¸  pnpm not found, skipping TypeScript checks"
fi

# 2. Biome linting
echo "ğŸ”§ Running Biome linting..."
if command -v pnpm &> /dev/null; then
    pnpm lint || {
        echo "âŒ Biome linting failed"
        exit 1
    }
else
    echo "âš ï¸  pnpm not found, skipping linting"
fi

# 3. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
echo "ğŸ§ª Running unit tests..."
if command -v pnpm &> /dev/null; then
    pnpm test --run || {
        echo "âŒ Unit tests failed"
        exit 1
    }
else
    echo "âš ï¸  pnpm not found, skipping tests"
fi

# 4. ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
echo "ğŸ—ï¸  Testing build..."
if command -v pnpm &> /dev/null; then
    pnpm build || {
        echo "âŒ Build failed"
        exit 1
    }
else
    echo "âš ï¸  pnpm not found, skipping build test"
fi

echo "âœ… All pre-commit checks passed!"

# éŸ³å£°é€šçŸ¥
if [ -f ".claude/hooks/task-narrator" ]; then
    task_complete "commit" "success"
fi